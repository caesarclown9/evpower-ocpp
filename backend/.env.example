# EvPower Backend - Environment Variables Example
# Скопируйте этот файл в .env и заполните реальными значениями

# =============================================================================
# DATABASE & SUPABASE
# =============================================================================
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key-here
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here
SUPABASE_JWT_SECRET=your-jwt-secret-here
SUPABASE_JWKS_URL=https://your-project.supabase.co/auth/v1/.well-known/jwks.json
JWT_VERIFY_ISS=https://your-project.supabase.co/auth/v1
DATABASE_URL=postgresql://postgres:password@db.your-project.supabase.co:5432/postgres

# =============================================================================
# REDIS (для OCPP и WebSocket)
# =============================================================================
REDIS_URL=redis://localhost:6379/0
# Для production используйте Upstash или Redis Cloud с SSL:
# REDIS_URL=rediss://default:password@your-redis-server:6379

# =============================================================================
# APP CONFIGURATION
# =============================================================================
APP_HOST=0.0.0.0
APP_PORT=9210
APP_ENV=development  # development | testing | production
LOG_LEVEL=INFO       # DEBUG | INFO | WARNING | ERROR
DOMAIN=https://ocpp.evpower.kg

# =============================================================================
# CORS (разделенные запятой домены)
# =============================================================================
CORS_ORIGINS=http://localhost:3000,https://app.flutterflow.io,https://ocpp.evpower.kg

# =============================================================================
# SECURITY
# =============================================================================
CLIENT_FALLBACK_SECRET=your-hmac-secret-key-here
STATION_MASTER_API_KEY=your-station-master-api-key-here
VERIFY_STATION_API_KEYS=true  # false только для локальной разработки

# Rate Limiting
RATE_LIMIT_DEFAULT_PER_MINUTE=60
RATE_LIMIT_CRITICAL_PER_MINUTE=10
RATE_LIMIT_WEBHOOK_PER_MINUTE=30  # Защита webhook от DDoS атак

# Swagger UI (включать только для development)
ENABLE_SWAGGER=false  # true только для development

# =============================================================================
# PAYMENT PROVIDER SELECTION
# =============================================================================
# Выбор платежного провайдера: ODENGI (production) или OBANK (в разработке)
PAYMENT_PROVIDER=ODENGI

# =============================================================================
# O!DENGI PAYMENT API (АКТИВНЫЙ ПРОВАЙДЕР)
# =============================================================================
# Тестовый API
ODENGI_API_URL=https://mw-api-test.dengi.kg/api/json/json.php
ODENGI_MERCHANT_ID=your-test-merchant-id
ODENGI_PASSWORD=your-test-password
ODENGI_WEBHOOK_SECRET=your-webhook-secret
ODENGI_USE_PRODUCTION=false

# Production API (получить у O!Dengi при регистрации)
ODENGI_PRODUCTION_API_URL=https://mw-api.dengi.kg/api/json/json.php
ODENGI_PROD_MERCHANT_ID=your-production-merchant-id
ODENGI_PROD_PASSWORD=your-production-password

# =============================================================================
# OBANK PAYMENT API (ВРЕМЕННО ОТКЛЮЧЕНО)
# =============================================================================
# ⚠️ OBANK интеграция в разработке, не готова для production
# Не включайте OBANK_ENABLED пока не завершена настройка

OBANK_ENABLED=false  # НЕ МЕНЯТЬ на true без завершения интеграции

# OBANK Test API
OBANK_API_URL=https://test-rakhmet.dengi.kg:4431/external/extended-cert
OBANK_POINT_ID=your-test-point-id
OBANK_SERVICE_ID=your-test-service-id
OBANK_CERT_PATH=/path/to/certificate.p12
OBANK_CERT_PASSWORD=your-cert-password
OBANK_USE_PRODUCTION=false

# OBANK Production API (получить у OBANK)
OBANK_PRODUCTION_API_URL=https://rakhmet.dengi.kg:4431/external/extended-cert
OBANK_PROD_POINT_ID=your-production-point-id
OBANK_PROD_SERVICE_ID=your-production-service-id

# =============================================================================
# PAYMENT CONFIGURATION
# =============================================================================
DEFAULT_CURRENCY=KGS
QR_CODE_LIFETIME_MINUTES=5
INVOICE_LIFETIME_MINUTES=10
STATUS_CHECK_INTERVAL_SECONDS=15
CLEANUP_INTERVAL_MINUTES=60
PAYMENT_TIMEOUT_MINUTES=30

# =============================================================================
# EZS (для совместимости)
# =============================================================================
EZS_SECRET_KEY=your-ezs-secret-key-here

# =============================================================================
# WEB PUSH NOTIFICATIONS (VAPID)
# =============================================================================
# Генерация VAPID keys:
# pip install cryptography
# python3 -c "from cryptography.hazmat.primitives.asymmetric import ec; from cryptography.hazmat.primitives import serialization; from cryptography.hazmat.backends import default_backend; import base64; private_key = ec.generate_private_key(ec.SECP256R1(), default_backend()); public_key = private_key.public_key(); private_der = private_key.private_bytes(encoding=serialization.Encoding.DER, format=serialization.PrivateFormat.PKCS8, encryption_algorithm=serialization.NoEncryption()); public_numbers = public_key.public_numbers(); public_bytes = (b'\x04' + public_numbers.x.to_bytes(32, 'big') + public_numbers.y.to_bytes(32, 'big')); print('VAPID_PRIVATE_KEY=' + base64.urlsafe_b64encode(private_der).decode('utf-8').rstrip('=')); print('VAPID_PUBLIC_KEY=' + base64.urlsafe_b64encode(public_bytes).decode('utf-8').rstrip('='))"

# VAPID Keys (сгенерируйте новые для production!)
VAPID_PRIVATE_KEY=MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQg3C9gIjI-YSxoCeLXlyJRZDJAAg84IxjJ7E75dulq8jWhRANCAAQnnmLryZn9JwQGBVrS1FeFfw98v1lu5PRJ_Lb7xtta8PAfQIbQnP98fSr0S6NsYf-q9Kf71zAa8xZoIvMsLY8i
VAPID_PUBLIC_KEY=BCeeYuvJmf0nBAYFWtLUV4V_D3y_WW7k9En8tvvG21rw8B9AhtCc_3x9KvRLo2xh_6r0p_vXMBrzFmgi8ywtjyI
VAPID_SUBJECT=mailto:noreply@evpower.kg

# Push Notifications Settings
PUSH_NOTIFICATIONS_ENABLED=true
PUSH_MAX_RETRIES=3
PUSH_TTL=86400  # 24 hours in seconds

# =============================================================================
# ВАЖНЫЕ ЗАМЕЧАНИЯ
# =============================================================================
# 1. НИКОГДА не коммитьте .env в Git!
# 2. Используйте сильные пароли и секреты (минимум 32 символа)
# 3. Для production используйте secrets manager (AWS Secrets, Vault)
# 4. Ротируйте секреты регулярно (каждые 90 дней минимум)
# 5. Храните production секреты только в защищенном хранилище
